extends base.pug

block content
    // 포스트 내용 및 메타데이터 출력
    div
        != post.content
        small 작성자: #{post.writer}
        small 작성일: #{formattedPostDate}
        br
        small 조회수: #{post.meta.views}
        br
        small 좋아요: #{post.meta.like}
        br
        small 댓글 개수: #{post.comments.length}
        br        
        button(onclick="likePost()") 좋아요

    a(href=`/post/${post._id}/edit`) Edit Post &rarr;
    br
    a(href=`/post/${post._id}/delete`) Delete Post &rarr;

    // 댓글 섹션
    h2 댓글
    ul#comments
        each comment in post.comments
            li
                strong= comment.author
                p= comment.content
                small 작성일: #{comment.formattedCreatedAt}
                
                // 댓글 수정 폼
                form(action=`/post/${post._id}/comment/${comment._id}/edit`, method="post", id=`edit-form-${comment._id}`, class="edit-form", style="display:none;")
                    textarea(name="content", required)= comment.content
                    button(type="submit") Edit Comment

                // 댓글 수정 버튼
                button(type="button", onclick=`toggleEditForm('${comment._id}')`) Edit Comment

                // 댓글 삭제 폼
                form(action=`/post/${post._id}/comment/${comment._id}/delete`, method="post")
                    button(type="submit") Delete Comment

    // 댓글 추가 폼
    form(action=`/post/${post._id}/comment`, method="post")
        input(type="text", name="author", value="댓글작성자1", readonly)
        textarea(name="content", placeholder="Your Comment", required)
        button(type="submit") Add Comment

block scripts
    script.
        const postId = '#{post._id}';

        function likePost() {
            fetch(`/post/${postId}/like`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => {
                if(response.ok) {
                    location.reload(); // 페이지 새로고침
                } else {
                    console.error('Failed to increase likes.');
                }
            }).catch(error => console.error('Error:', error));
        }

        function toggleEditForm(commentId) {
            const form = document.getElementById(`edit-form-${commentId}`);
            if (form.style.display === "none") {
                form.style.display = "block";
            } else {
                form.style.display = "none";
            }
        }
